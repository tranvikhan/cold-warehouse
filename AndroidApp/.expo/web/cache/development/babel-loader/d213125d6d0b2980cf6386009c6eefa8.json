{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"D:\\\\GIT HUB\\\\NCKH2020\\\\KHAN\\\\AndroidApp\\\\src\\\\screens\\\\status\\\\components\\\\TChart.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport { GLView } from 'expo-gl';\nimport { Renderer } from 'expo-three';\nimport OrbitControlsView from 'expo-three-orbit-controls';\nimport React, { useState, useRef, useEffect } from 'react';\nimport * as THREE from 'three';\nimport perfectChart from \"./perfectChart.js\";\nvar Config = {\n  \"size\": {\n    \"x\": 3,\n    \"y\": 3,\n    \"z\": 3,\n    \"tilesize\": 5\n  },\n  \"door\": {\n    \"show\": true,\n    \"direction\": \"A\"\n  },\n  \"axis-labels\": {\n    \"axis-x\": {\n      \"show\": true,\n      \"list\": [0, 5, 12, 19]\n    },\n    \"axis-y\": {\n      \"show\": true,\n      \"list\": [2, 6]\n    },\n    \"axis-z\": {\n      \"show\": true,\n      \"list\": [5, 9]\n    }\n  }\n};\n\nvar _3rd = function _3rd() {\n  var iMin = 999;\n  var iMax = -999;\n  var rd;\n  return {\n    values: new Array(50).fill(0).map(function (x) {\n      return new Array(23).fill(0).map(function (x) {\n        return new Array(24).fill(0).map(function (x) {\n          rd = Math.random() * 1024;\n          if (rd < iMin) iMin = rd;\n          if (rd > iMax) iMax = rd;\n          return rd;\n        });\n      });\n    }),\n    min: iMin,\n    max: iMax\n  };\n};\n\nvar Data = {\n  \"values\": [[[0, 1, 2], [0, 1, 2], [0, 1, 2]], [[0, 1, 2], [0, 1, 2], [0, 1, 2]], [[0, 1, 2], [0, 1, 2], [0, 1, 2]]],\n  \"min\": 0,\n  \"max\": 2\n};\nvar Slice = {\n  origin: null,\n  destination: null\n};\nexport default function App() {\n  useEffect(function () {}, []);\n  return React.createElement(React.Fragment, null, React.createElement(Chart, {\n    config: Config,\n    data: Data,\n    slice: Slice,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 13\n    }\n  }));\n}\n\nvar nativeChart = function (_perfectChart) {\n  _inherits(nativeChart, _perfectChart);\n\n  var _super = _createSuper(nativeChart);\n\n  function nativeChart() {\n    _classCallCheck(this, nativeChart);\n\n    return _super.apply(this, arguments);\n  }\n\n  _createClass(nativeChart, [{\n    key: \"initWorld\",\n    value: function initWorld(gl) {\n      var _this = this;\n\n      console.log(\"=> initWorld\");\n      var width = gl.drawingBufferWidth,\n          height = gl.drawingBufferHeight;\n      var scene = new THREE.Scene();\n      scene.background = new THREE.Color(0x151A30);\n      var renderer = new Renderer({\n        gl: gl\n      });\n      renderer.setSize(width, height);\n      var camera = new THREE.PerspectiveCamera(70, width / height, 0.01, 1000);\n      camera.up.set(0, 0, 1);\n      var sz = this.config.size;\n      camera.position.set((sz.x + 5) * sz.tilesize, (sz.y + 5) * sz.tilesize, (sz.z + 5) * sz.tilesize);\n      var axesHelper = new THREE.AxesHelper(7749);\n      scene.add(axesHelper);\n\n      var animate = function animate() {\n        var timeout = requestAnimationFrame(animate);\n        _this.timeout = timeout;\n        renderer.render(scene, camera);\n        gl.endFrameEXP();\n      };\n\n      animate();\n      this.scene = scene;\n      this.camera = camera;\n      this.renderer = renderer;\n      this.axesHelper = axesHelper;\n      console.log(\"initWorld =>\");\n    }\n  }]);\n\n  return nativeChart;\n}(perfectChart);\n\nfunction Chart(props) {\n  var orbitControls = useRef(null);\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      camera = _useState2[0],\n      setCamera = _useState2[1];\n\n  var chartView = useRef(null);\n\n  var onContextCreate = function onContextCreate(gl) {\n    var chart;\n    return _regeneratorRuntime.async(function onContextCreate$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            console.log(\"=> onContextCreate\");\n            chart = new nativeChart(null);\n            chart.setConfig(props.config);\n            chart.initWorld(gl);\n            setCamera(chart.camera);\n            chart.makeDoor();\n            chart.makeWireFrame();\n            chart.reCalculationLimit(props.slice);\n            chart.makeFrame();\n            chart.updateChart(props.data);\n            console.log(\"onContextCreate =>\");\n\n          case 11:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var initChartView = function initChartView() {\n    chartView.current == null && (console.log(\"=> initChartView\"), chartView.current = React.createElement(GLView, {\n      style: {\n        flex: 1\n      },\n      onContextCreate: onContextCreate\n    }), console.log(\"initChartView =>\"));\n    var centering = setInterval(function () {\n      var ctrl = null;\n\n      try {\n        ctrl = orbitControls.current.getControls();\n      } catch (_unused) {}\n\n      if (ctrl) {\n        var sz = props.config.size;\n        ctrl.target.set(sz.x / 2 * sz.tilesize, sz.y / 2 * sz.tilesize, sz.z / 2 * sz.tilesize);\n        console.log(ctrl.target);\n        clearInterval(centering);\n      }\n    }, 100);\n  };\n\n  useEffect(function () {\n    console.log(\"\\n\".repeat(3) + \"===== START =====\");\n    initChartView();\n    return function () {\n      console.log(\"===== END =====\");\n    };\n  }, []);\n  return React.createElement(React.Fragment, null, console.log(\"=> Component return\"), React.createElement(OrbitControlsView, {\n    style: {\n      flex: 1,\n      width: \"100%\",\n      height: \"100%\"\n    },\n    camera: camera,\n    ref: orbitControls,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 13\n    }\n  }, (initChartView(), chartView.current)), console.log(\"Component return =>\"));\n}","map":{"version":3,"sources":["D:/GIT HUB/NCKH2020/KHAN/AndroidApp/src/screens/status/components/TChart.js"],"names":["GLView","Renderer","OrbitControlsView","React","useState","useRef","useEffect","THREE","perfectChart","Config","_3rd","iMin","iMax","rd","values","Array","fill","map","x","Math","random","min","max","Data","Slice","origin","destination","App","nativeChart","gl","console","log","width","drawingBufferWidth","height","drawingBufferHeight","scene","Scene","background","Color","renderer","setSize","camera","PerspectiveCamera","up","set","sz","config","size","position","tilesize","y","z","axesHelper","AxesHelper","add","animate","timeout","requestAnimationFrame","render","endFrameEXP","Chart","props","orbitControls","setCamera","chartView","onContextCreate","chart","setConfig","initWorld","makeDoor","makeWireFrame","reCalculationLimit","slice","makeFrame","updateChart","data","initChartView","current","createElement","style","flex","centering","setInterval","ctrl","getControls","target","clearInterval","repeat"],"mappings":"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","sourcesContent":["import { GLView } from 'expo-gl';\r\nimport { Renderer } from 'expo-three';\r\nimport OrbitControlsView from 'expo-three-orbit-controls';\r\nimport React, {useState, useRef, useEffect} from 'react';\r\nimport * as THREE from 'three';\r\nimport perfectChart from './perfectChart.js';\r\n\r\nlet Config =\r\n{\r\n  \"size\": {\r\n    \"x\": 3,\r\n    \"y\": 3,\r\n    \"z\": 3,\r\n    \"tilesize\": 5\r\n  },\r\n  \"door\": {\r\n    \"show\": true,\r\n    \"direction\": \"A\"//\"4 hướng là 4 cạnh của hình chữ nhật có thể đánh dấu A B C D\"\r\n  },\r\n  \"axis-labels\": {\r\n    \"axis-x\": {\r\n      \"show\": true,\r\n      \"list\": [0, 5, 12, 19]\r\n    },\r\n    \"axis-y\": {\r\n      \"show\": true,\r\n      \"list\": [2, 6]\r\n    },\r\n    \"axis-z\": {\r\n      \"show\": true,\r\n      \"list\": [5, 9]\r\n    }\r\n  }\r\n}\r\n\r\nlet _3rd = () => {\r\n  let iMin = 999;\r\n  let iMax = -999;\r\n  let rd;\r\n  return { values: new Array(50).fill(0).map(\r\n  x => new Array(23).fill(0).map(\r\n    x => new Array(24).fill(0).map(\r\n      x => {\r\n        rd = Math.random()*1024;\r\n        if (rd < iMin) iMin = rd;\r\n        if (rd > iMax) iMax = rd;\r\n        return rd;\r\n      }\r\n      )\r\n    )\r\n  ),\r\n  min: iMin,\r\n  max: iMax\r\n  }\r\n};\r\nlet Data =\r\n{\r\n\t\"values\":\r\n\t[[\r\n\t\t[0, 1, 2],\r\n\t\t[0, 1, 2],\r\n\t\t[0, 1, 2]\r\n\t],\r\n\t[\r\n\t\t[0, 1, 2],\r\n\t\t[0, 1, 2],\r\n\t\t[0, 1, 2]\r\n\t],\r\n\t[\r\n\t\t[0, 1, 2],\r\n\t\t[0, 1, 2],\r\n\t\t[0, 1, 2]\r\n\t]],\r\n\t\"min\": 0,\r\n\t\"max\": 2\r\n}\r\n\r\nlet Slice =\r\n{\r\n    origin: null,\r\n    destination: null\r\n}\r\n\r\nexport default function App(){\r\n    //const [s, setS] = new useState(null)\r\n\r\n    useEffect(()=>{\r\n    },[])\r\n\r\n    return(\r\n        <>\r\n            <Chart config={Config} data={Data} slice={Slice}/>\r\n        </>\r\n    )\r\n}\r\n\r\nclass nativeChart extends perfectChart{\r\n\r\n    initWorld(gl){\r\n        console.log(\"=> initWorld\");\r\n        const { drawingBufferWidth: width, drawingBufferHeight: height } = gl;\r\n\r\n        const scene = new THREE.Scene();\r\n        scene.background = new THREE.Color(0x151A30);\r\n\r\n        const renderer = new Renderer({ gl });\r\n        renderer.setSize(width, height);\r\n\r\n        const camera = new THREE.PerspectiveCamera(70, width / height, 0.01, 1000);\r\n        camera.up.set(0,0,1);\r\n        const sz = this.config.size;\r\n        camera.position.set(\r\n            (sz.x+5)*sz.tilesize,\r\n            (sz.y+5)*sz.tilesize,\r\n            (sz.z+5)*sz.tilesize\r\n        );\r\n\r\n        //make axesHelper\r\n        let axesHelper = new THREE.AxesHelper(7749);\r\n        scene.add(axesHelper);\r\n\r\n        let animate = () => {\r\n            let timeout = requestAnimationFrame(animate);\r\n            this.timeout = timeout;\r\n            renderer.render(scene, camera);\r\n            gl.endFrameEXP();\r\n        };\r\n        animate();\r\n\r\n        this.scene = scene;\r\n        this.camera = camera;\r\n        this.renderer = renderer;\r\n        this.axesHelper = axesHelper;\r\n        console.log(\"initWorld =>\");\r\n    }\r\n}\r\n\r\nfunction Chart(props) {\r\n    const orbitControls = useRef(null);\r\n    const [camera, setCamera] = useState(null);\r\n    const chartView = useRef(null);\r\n\r\n    const onContextCreate = async (gl) => {\r\n        console.log(\"=> onContextCreate\");\r\n        let chart = new nativeChart(null);\r\n        chart.setConfig(props.config);\r\n        chart.initWorld(gl);\r\n        setCamera(chart.camera);\r\n        chart.makeDoor();\r\n        chart.makeWireFrame();\r\n        chart.reCalculationLimit(props.slice);\r\n        chart.makeFrame();\r\n        chart.updateChart(props.data);\r\n        console.log(\"onContextCreate =>\");\r\n    };\r\n\r\n    const initChartView = () => {\r\n        // https://github.com/expo/expo/issues/3877\r\n        (chartView.current==null) && (\r\n            console.log(\"=> initChartView\"),\r\n            chartView.current = React.createElement(GLView,{\r\n                style: { flex: 1 },\r\n                onContextCreate: onContextCreate\r\n            }),\r\n            console.log(\"initChartView =>\")\r\n        )\r\n\r\n        let centering = setInterval(()=>{\r\n          let ctrl = null;\r\n          try{ctrl = orbitControls.current.getControls()} catch{}\r\n          if (ctrl){\r\n           \r\n              let sz = props.config.size;\r\n              \r\n              ctrl.target.set(\r\n                  sz.x/2*sz.tilesize,\r\n                  sz.y/2*sz.tilesize,\r\n                  sz.z/2*sz.tilesize);\r\n                  console.log(ctrl.target);\r\n               clearInterval(centering); \r\n          }\r\n      },100);\r\n    }\r\n\r\n    useEffect(() => {\r\n        console.log(\"\\n\".repeat(3)+\"===== START =====\");\r\n        initChartView();\r\n        return () => {\r\n            console.log(\"===== END =====\");\r\n            //Clear the animation loop when the component unmounts\r\n            //clearTimeout(timeout);\r\n            //chartView.current = null;\r\n        }\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            {console.log(\"=> Component return\")}\r\n            <OrbitControlsView style={{ flex: 1,width:\"100%\",height:\"100%\" }} camera={camera} ref={orbitControls}>\r\n                {\r\n                    initChartView(),\r\n                    chartView.current\r\n                }\r\n            </OrbitControlsView>\r\n            {console.log(\"Component return =>\")}\r\n        </>\r\n    );\r\n}"]},"metadata":{},"sourceType":"module"}