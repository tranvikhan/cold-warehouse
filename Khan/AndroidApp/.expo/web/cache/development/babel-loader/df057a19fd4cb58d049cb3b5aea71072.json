{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { uriAsync } from 'expo-asset-utils';\nimport resolveAsset, { stringFromAsset } from \"./resolveAsset\";\nimport { loadTexture } from \"./loadTexture\";\nimport { loadDaeAsync, loadObjAsync, loadMtlAsync, loadArrayBufferAsync } from \"./loaders/loadModelsAsync\";\nimport \"./polyfillTextureLoader.fx\";\nimport { loadTextureAsync } from \"./loaders/loadTextureAsync\";\nimport { loaderClassForExtension, loaderClassForUri } from \"./loaderClassForExtension\";\nexport function loadBasicModelAsync(options) {\n  var uri, onProgress, onAssetRequested, loader, LoaderClass, _loader;\n\n  return _regeneratorRuntime.async(function loadBasicModelAsync$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          uri = options.uri, onProgress = options.onProgress, onAssetRequested = options.onAssetRequested, loader = options.loader, LoaderClass = options.LoaderClass;\n          _loader = loader || new LoaderClass();\n\n          if (_loader.setPath) {\n            _loader.setPath(onAssetRequested);\n          }\n\n          return _context.abrupt(\"return\", new Promise(function (res, rej) {\n            return _loader.load(uri, res, onProgress, rej);\n          }));\n\n        case 4:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\nexport default function loadAsync(res, onProgress) {\n  var onAssetRequested,\n      urls,\n      asset,\n      url,\n      arrayBuffer,\n      AssimpLoader,\n      loader,\n      _arrayBuffer,\n      FBXLoader,\n      _loader2,\n      _arrayBuffer2,\n      GLTFLoader,\n      _loader3,\n      XLoader,\n      texLoader,\n      _loader4,\n      LoaderClass,\n      urlB,\n      _args2 = arguments;\n\n  return _regeneratorRuntime.async(function loadAsync$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          onAssetRequested = _args2.length > 2 && _args2[2] !== undefined ? _args2[2] : function () {};\n          _context2.next = 3;\n          return _regeneratorRuntime.awrap(resolveAsset(res));\n\n        case 3:\n          urls = _context2.sent;\n\n          if (urls) {\n            _context2.next = 6;\n            break;\n          }\n\n          throw new Error(\"ExpoTHREE.loadAsync: Cannot parse undefined assets. Please pass valid resources for: \" + res + \".\");\n\n        case 6:\n          asset = urls[0];\n          _context2.next = 9;\n          return _regeneratorRuntime.awrap(uriAsync(asset));\n\n        case 9:\n          url = _context2.sent;\n\n          if (!(url == null)) {\n            _context2.next = 12;\n            break;\n          }\n\n          throw new Error(\"ExpoTHREE.loadAsync: this asset couldn't be downloaded. Be sure that your app.json contains the correct extensions.\");\n\n        case 12:\n          if (!(urls.length === 1)) {\n            _context2.next = 71;\n            break;\n          }\n\n          if (!url.match(/\\.(jpeg|jpg|gif|png)$/)) {\n            _context2.next = 17;\n            break;\n          }\n\n          return _context2.abrupt(\"return\", loadTextureAsync({\n            asset: asset\n          }));\n\n        case 17:\n          if (!url.match(/\\.assimp$/i)) {\n            _context2.next = 26;\n            break;\n          }\n\n          _context2.next = 20;\n          return _regeneratorRuntime.awrap(loadArrayBufferAsync({\n            uri: url,\n            onProgress: onProgress\n          }));\n\n        case 20:\n          arrayBuffer = _context2.sent;\n          AssimpLoader = loaderClassForExtension('assimp');\n          loader = new AssimpLoader();\n          return _context2.abrupt(\"return\", loader.parse(arrayBuffer, onAssetRequested));\n\n        case 26:\n          if (!url.match(/\\.dae$/i)) {\n            _context2.next = 30;\n            break;\n          }\n\n          return _context2.abrupt(\"return\", loadDaeAsync({\n            asset: url,\n            onProgress: onProgress,\n            onAssetRequested: onAssetRequested\n          }));\n\n        case 30:\n          if (!url.match(/\\.fbx$/i)) {\n            _context2.next = 39;\n            break;\n          }\n\n          _context2.next = 33;\n          return _regeneratorRuntime.awrap(loadArrayBufferAsync({\n            uri: url,\n            onProgress: onProgress\n          }));\n\n        case 33:\n          _arrayBuffer = _context2.sent;\n          FBXLoader = loaderClassForExtension('fbx');\n          _loader2 = new FBXLoader();\n          return _context2.abrupt(\"return\", _loader2.parse(_arrayBuffer, onAssetRequested));\n\n        case 39:\n          if (!url.match(/\\.(glb|gltf)$/i)) {\n            _context2.next = 48;\n            break;\n          }\n\n          _context2.next = 42;\n          return _regeneratorRuntime.awrap(loadArrayBufferAsync({\n            uri: url,\n            onProgress: onProgress\n          }));\n\n        case 42:\n          _arrayBuffer2 = _context2.sent;\n          GLTFLoader = loaderClassForExtension('gltf');\n          _loader3 = new GLTFLoader();\n          return _context2.abrupt(\"return\", new Promise(function (res, rej) {\n            return _loader3.parse(_arrayBuffer2, onAssetRequested, res, rej);\n          }));\n\n        case 48:\n          if (!url.match(/\\.x$/i)) {\n            _context2.next = 55;\n            break;\n          }\n\n          XLoader = loaderClassForExtension('x');\n          texLoader = {\n            path: onAssetRequested,\n            load: loadTexture\n          };\n          _loader4 = new XLoader(undefined, texLoader);\n          return _context2.abrupt(\"return\", new Promise(function (res, rej) {\n            return _loader4.load([url, false], res, onProgress, rej);\n          }));\n\n        case 55:\n          if (!url.match(/\\.json$/i)) {\n            _context2.next = 59;\n            break;\n          }\n\n          throw new Error('loadAsync: Please use ExpoTHREE.parseAsync({json}) instead, json can be loaded in lots of different ways.');\n\n        case 59:\n          if (!url.match(/\\.obj$/i)) {\n            _context2.next = 63;\n            break;\n          }\n\n          return _context2.abrupt(\"return\", loadObjAsync({\n            asset: url,\n            onAssetRequested: onAssetRequested\n          }));\n\n        case 63:\n          if (!url.match(/\\.mtl$/i)) {\n            _context2.next = 67;\n            break;\n          }\n\n          return _context2.abrupt(\"return\", loadMtlAsync({\n            asset: url,\n            onAssetRequested: onAssetRequested\n          }));\n\n        case 67:\n          LoaderClass = loaderClassForUri(url);\n          return _context2.abrupt(\"return\", loadBasicModelAsync({\n            uri: url,\n            onProgress: onProgress,\n            onAssetRequested: onAssetRequested,\n            LoaderClass: LoaderClass\n          }));\n\n        case 69:\n          _context2.next = 86;\n          break;\n\n        case 71:\n          if (!(urls.length === 2)) {\n            _context2.next = 85;\n            break;\n          }\n\n          _context2.next = 74;\n          return _regeneratorRuntime.awrap(stringFromAsset(urls[1]));\n\n        case 74:\n          urlB = _context2.sent;\n\n          if (!(urlB != null)) {\n            _context2.next = 82;\n            break;\n          }\n\n          if (!(url.match(/\\.mtl$/i) && urlB.match(/\\.obj$/i))) {\n            _context2.next = 80;\n            break;\n          }\n\n          return _context2.abrupt(\"return\", loadObjAsync({\n            asset: urlB,\n            mtlAsset: url,\n            onAssetRequested: onAssetRequested\n          }));\n\n        case 80:\n          if (!(url.match(/\\.obj$/i) && urlB.match(/\\.mtl$/i))) {\n            _context2.next = 82;\n            break;\n          }\n\n          return _context2.abrupt(\"return\", loadObjAsync({\n            asset: url,\n            mtlAsset: urlB,\n            onAssetRequested: onAssetRequested\n          }));\n\n        case 82:\n          throw new Error('Unrecognized File Type: ' + url);\n\n        case 85:\n          throw new Error('Too many arguments passed: ' + urls);\n\n        case 86:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}","map":{"version":3,"sources":["../src/loadAsync.ts"],"names":[],"mappings":"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","sourcesContent":["import { uriAsync } from 'expo-asset-utils';\nimport resolveAsset, { stringFromAsset } from './resolveAsset';\nimport { ProgressCallback } from './loading.types';\nimport { loadTexture } from './loadTexture';\nimport {\n  loadDaeAsync,\n  loadObjAsync,\n  loadMtlAsync,\n  loadArrayBufferAsync,\n} from './loaders/loadModelsAsync';\nimport './polyfillTextureLoader.fx';\n\nimport { loadTextureAsync } from './loaders/loadTextureAsync';\nimport {\n  loaderClassForExtension,\n  loaderClassForUri,\n} from './loaderClassForExtension';\n\nexport async function loadBasicModelAsync(options: {\n  uri: string;\n  onProgress?: ProgressCallback;\n  onAssetRequested: any;\n  loader?: any;\n  LoaderClass: any;\n}) {\n  const { uri, onProgress, onAssetRequested, loader, LoaderClass } = options;\n  const _loader = loader || new LoaderClass();\n  if (_loader.setPath) {\n    _loader.setPath(onAssetRequested);\n  }\n  return new Promise((res, rej) => _loader.load(uri, res, onProgress, rej));\n}\n\nexport default async function loadAsync(\n  res,\n  onProgress?: ProgressCallback,\n  onAssetRequested = function() {}\n) {\n  let urls = await resolveAsset(res);\n  if (!urls) {\n    throw new Error(\n      `ExpoTHREE.loadAsync: Cannot parse undefined assets. Please pass valid resources for: ${res}.`\n    );\n  }\n  const asset = urls[0];\n  let url: string | null = await uriAsync(asset);\n\n  if (url == null) {\n    throw new Error(\n      `ExpoTHREE.loadAsync: this asset couldn't be downloaded. Be sure that your app.json contains the correct extensions.`\n    );\n  }\n\n  if (urls.length === 1) {\n    if (url.match(/\\.(jpeg|jpg|gif|png)$/)) {\n      return loadTextureAsync({ asset });\n    } else if (url.match(/\\.assimp$/i)) {\n      const arrayBuffer = await loadArrayBufferAsync({ uri: url, onProgress });\n      const AssimpLoader = loaderClassForExtension('assimp');\n      const loader = new AssimpLoader();\n      return loader.parse(arrayBuffer, onAssetRequested);\n    } else if (url.match(/\\.dae$/i)) {\n      return loadDaeAsync({\n        asset: url,\n        onProgress,\n        onAssetRequested,\n      });\n    } else if (url.match(/\\.fbx$/i)) {\n      const arrayBuffer = await loadArrayBufferAsync({ uri: url, onProgress });\n      const FBXLoader = loaderClassForExtension('fbx');\n      const loader = new FBXLoader();\n      return loader.parse(arrayBuffer, onAssetRequested);\n    } else if (url.match(/\\.(glb|gltf)$/i)) {\n      const arrayBuffer = await loadArrayBufferAsync({ uri: url, onProgress });\n      const GLTFLoader = loaderClassForExtension('gltf');\n      const loader = new GLTFLoader();\n      return new Promise((res, rej) =>\n        loader.parse(arrayBuffer, onAssetRequested, res, rej)\n      );\n    } else if (url.match(/\\.x$/i)) {\n      const XLoader = loaderClassForExtension('x');\n\n      const texLoader = {\n        path: onAssetRequested,\n        load: loadTexture,\n      };\n      const loader = new XLoader(undefined, texLoader);\n      return new Promise((res, rej) =>\n        loader.load([url, false], res, onProgress, rej)\n      );\n    } else if (url.match(/\\.json$/i)) {\n      throw new Error(\n        'loadAsync: Please use ExpoTHREE.parseAsync({json}) instead, json can be loaded in lots of different ways.'\n      );\n    } else if (url.match(/\\.obj$/i)) {\n      return loadObjAsync({ asset: url, onAssetRequested });\n    } else if (url.match(/\\.mtl$/i)) {\n      return loadMtlAsync({ asset: url, onAssetRequested });\n    } else {\n      const LoaderClass = loaderClassForUri(url);\n      return loadBasicModelAsync({\n        uri: url,\n        onProgress,\n        onAssetRequested,\n        LoaderClass,\n      });\n    }\n  } else if (urls.length === 2) {\n    let urlB = await stringFromAsset(urls[1]);\n    if (urlB != null) {\n      if (url.match(/\\.mtl$/i) && urlB.match(/\\.obj$/i)) {\n        return loadObjAsync({\n          asset: urlB,\n          mtlAsset: url,\n          onAssetRequested,\n        });\n      } else if (url.match(/\\.obj$/i) && urlB.match(/\\.mtl$/i)) {\n        return loadObjAsync({\n          asset: url,\n          mtlAsset: urlB,\n          onAssetRequested,\n        });\n      }\n    }\n\n    throw new Error('Unrecognized File Type: ' + url);\n  } else {\n    throw new Error('Too many arguments passed: ' + urls);\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}